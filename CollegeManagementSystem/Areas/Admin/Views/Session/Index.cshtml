@using CMS.CommonHelper
@{
    ViewData["Title"] = "Central College";
    TempData["Title"] = "Sessions";
}

<div>

    <div class="row mb-4">
        <div class="col-6">
            <h2 class="m-0">Sessions</h2>
        </div>

        <div class="col-6 button-col">
            <a asp-area="Admin" asp-controller="Session" asp-action="Create" class="btn custom-btn">Add</a>
        </div>
    </div>

    <div class="row">

        <div class="col-12">

            <table class="table table-bordered" id="SessionTable">

                <thead>
                    <tr>
                        <th>Session Name</th>
                        <th>Start Time</th>
                        <th>End Time</th>
                        <th>Admission Fee</th>
                        <th>Monthly Fee</th>
                        <th>Merit</th>
                        <th>Status</th>
                        <th>Action</th>
                    </tr>
                </thead>
            </table>

        </div>

    </div>

</div>


@section scripts {

    <script>

        let SessionTable;

        SessionTable = $('#SessionTable').DataTable({

            "ajax": {
                "url": "/Admin/Session/GetSessions"
            },
            "columns": [

                { "data": "sessionName" },
                {
                    "data": "startTime",
                    "render": function (data) {
                        const date = new Date(data);
                        return date.toLocaleDateString('en-PK');
                    }
                },
                {
                    "data": "endTime",
                    "render": function (data) {
                        const date = new Date(data);
                        return date.toLocaleDateString('en-PK');
                    }
                },
                { "data": "admissionFee" },
                { "data": "monthlyFee" },
                { "data": "merit" },
                { 
                    "data": "status",
                    "render": function (data) {
                        if (data == '@SessionStatus.UpComing') {
                            return "Up Coming";
                        }
                        return data;
                    }

                },
                {
                    "data": "id",
                    "render": function (data) {
                        return `
                            <a class="edit-btn" href="/Admin/Session/Update?id=${data}"><i class="bi bi-pencil-square"></i></a>
                            <a class="delete-btn" onclick=RemoveSesssion("/Admin/Session/Delete/${data}")><i class="bi bi-trash3-fill"></i></a>
                        `
                    }
                }

            ]


        });


        function RemoveSesssion(url){

            Swal.fire({
                title: "Are you sure?",
                text: "You won't be able to revert this!",
                icon: "warning",
                showCancelButton: true,
                confirmButtonColor: "#3085d6",
                cancelButtonColor: "#d33",
                confirmButtonText: "Yes, delete it!"
                }).then((result) => {
                if (result.isConfirmed) {

                    var xmlHttp = new XMLHttpRequest();


                    xmlHttp.onreadystatechange = () => {

                        if (xmlHttp.readyState == 4 && (xmlHttp.status >= 200 && xmlHttp.status < 400)) {

                            var result = JSON.parse(xmlHttp.responseText);

                            if (result.result) {
                                SessionTable.ajax.reload();
                                toastr.success(result.message);
                            }
                            else {
                                toastr.error(message);
                            }

                        }

                    }
                    xmlHttp.open('DELETE', url, true);
                    xmlHttp.send();

                }

                


            });


        }

    </script>

}